<!DOCTYPE html>
<html lang="zh-Hant">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å…ƒå®µç¯€çŒœç‡ˆè¬ - Lantern Festival Riddle Game</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Ma+Shan+Zheng&family=Noto+Sans+SC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        html, body {
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            color: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 0;
            min-height: 100vh;
            min-width: 100vw;
            background: linear-gradient(135deg, #8b0000 0%, #ff4500 100%);
            background-image: url('images/background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
        }

        /* å±å¹•æ–¹å‘æç¤º */
        #orientation-message {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            color: white;
            z-index: 9999;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
            padding: 20px;
        }
        
        #orientation-message i {
            font-size: 4rem;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        #orientation-message h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: #ffd700;
        }
        
        #orientation-message p {
            font-size: 1.5rem;
            max-width: 600px;
        }

        .container {
            width: 100vw;
            height: 100vh;
            max-width: 100vw;
            max-height: 100vh;
            display: flex;
            flex-direction: column;
            position: relative;
            overflow: hidden;
            padding: 10px;
        }

        /* æ ‡é¢˜æ ·å¼ */
        header {
            text-align: center;
            padding: 5px 0;
            margin-bottom: 5px;
            position: relative;
            z-index: 2;
            flex-shrink: 0;
        }

        h1 {
            font-family: 'Ma Shan Zheng', cursive;
            font-size: 2.8rem;
            color: #ffd700;
            text-shadow: 3px 3px 0 #8b0000, 6px 6px 10px rgba(0,0,0,0.5);
            margin-bottom: 5px;
            line-height: 1.1;
        }

        .subtitle {
            font-size: 1rem;
            color: #fff;
            max-width: 600px;
            margin: 0 auto;
            background-color: rgba(139, 0, 0, 0.7);
            padding: 8px 15px;
            border-radius: 15px;
            border: 2px solid #ffd700;
            line-height: 1.2;
        }

        /* æ¸¸æˆåŒºåŸŸ */
        .game-container {
            background-color: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            padding: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            position: relative;
            z-index: 2;
            border: 5px solid #ffd700;
            overflow: hidden;
        }

        /* ---------- è¯­è¨€é€‰æ‹©ç•Œé¢ï¼ˆå«æ–°å¢æ’è¡Œæ¦œæŒ‰é’®ï¼‰ ---------- */
        .language-selection {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            width: 50vw;
            height: 50vh;
            margin: auto;
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
        }

        .language-selection h2 {
            font-size: 1.6rem;
            color: #8b0000;
            margin-bottom: 15px;
            text-align: center;
        }

        .language-options {
            display: flex;
            gap: 15px;
            justify-content: center;
            align-items: center;
            width: 100%;
            flex: 1 1 auto;
            min-height: 0;
        }

        .language-btn {
            width: 45%;
            height: 80%;
            border-radius: 15px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            font-size: 1.4rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            border: 4px solid transparent;
        }

        .language-btn:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
        }

        .language-btn.chinese {
            background: linear-gradient(135deg, #ff0000, #ff4500);
            color: white;
        }

        .language-btn.english {
            background: linear-gradient(135deg, #00509e, #1e90ff);
            color: white;
        }

        .language-btn i {
            font-size: 2.8rem;
            margin-bottom: 12px;
        }

        /* é¦–é æŸ¥çœ‹æ’è¡Œæ¦œæŒ‰éˆ• */
        .btn-view-leaderboard {
            margin-top: 20px;
            width: 60%;
            padding: 12px 20px;
            background-color: #8b0000;
            color: white;
            border: 2px solid #ffd700;
            border-radius: 40px;
            font-size: 1.2rem;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }
        .btn-view-leaderboard:hover {
            background-color: #ff4500;
            transform: scale(1.02);
            border-color: #fff;
        }
        .btn-view-leaderboard i {
            font-size: 1.3rem;
        }

        /* æ¸¸æˆè¿›è¡Œç•Œé¢ */
        #game-screen {
            display: none;
            flex-direction: column;
            height: 100%;
            width: 100%;
        }

        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 1px dashed #8b0000;
            flex-shrink: 0;
        }

        .stats {
            display: flex;
            gap: 8px;
            font-size: 0.8rem;
            flex-grow: 1;
        }

        .stat-item {
            background-color: #8b0000;
            color: white;
            padding: 4px 8px;
            border-radius: 6px;
            flex: 1;
            text-align: center;
            min-width: 0;
        }

        .stat-item .value {
            font-size: 1.2rem;
            font-weight: bold;
            color: #ffd700;
        }

        .restart-btn {
            margin-left: 8px;
            flex-shrink: 0;
        }

        .restart-btn .btn {
            padding: 6px 12px;
            font-size: 0.9rem;
        }

        /* è¬é¡Œå€åŸŸ */
        .riddle-container {
            text-align: center;
            padding: 10px;
            margin-bottom: 10px;
            background-color: #fff8e1;
            border-radius: 10px;
            border: 2px solid #ffd700;
            box-shadow: inset 0 0 10px rgba(255, 69, 0, 0.1);
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 0;
            overflow: hidden;
        }

        .riddle-text {
            font-size: 2rem;
            line-height: 1.2;
            color: #333;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            width: 100%;
            height: 100%;
            margin: 0;
            padding: 5px;
            white-space: normal;
            word-break: break-word;
        }

        /* é¸é …å€åŸŸ */
        .options-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            grid-template-rows: repeat(2, 1fr);
            gap: 10px;
            margin-bottom: 10px;
            flex-grow: 1;
            min-height: 0;
        }

        .option-btn {
            padding: 15px 10px;
            font-size: 1.3rem;
            background-color: #f8f8f8;
            border: 3px solid #8b0000;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            word-break: break-word;
            overflow: hidden;
        }

        .option-btn:hover {
            background-color: #ffe4b5;
            transform: translateY(-3px);
        }

        .option-btn.correct {
            background-color: #32cd32 !important;
            color: white;
            border-color: #228b22;
        }

        .option-btn.wrong {
            background-color: #ff4444 !important;
            color: white;
            border-color: #cc0000;
        }

        .option-btn.disabled {
            pointer-events: none;
            opacity: 0.7;
        }

        /* æŒ‰éˆ•å€åŸŸ */
        .button-container {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-shrink: 0;
        }

        .btn {
            padding: 12px 20px;
            font-size: 1.1rem;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            justify-content: center;
        }

        .btn-primary {
            background-color: #8b0000;
            color: white;
        }

        .btn-primary:hover {
            background-color: #ff4500;
            transform: scale(1.03);
        }

        .btn-secondary {
            background-color: #f0f0f0;
            color: #333;
        }

        .btn-secondary:hover {
            background-color: #ddd;
        }

        /* èƒœåˆ©è§†é¢‘ */
        #victory-video {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            z-index: 1000;
            display: none;
        }

        /* ---------- æäº¤è¡¨å•ï¼ˆæŒ‘æˆ°å®Œæˆé é¢ï¼‰ ç„¡æ»¾å‹•æ¢ã€ç·Šæ¹Šæ’ç‰ˆ ---------- */
        .submit-form {
            display: none;
            background-color: white;
            padding: 12px 18px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
            width: 100%;
            height: 100%;
            text-align: center;
            overflow: hidden;          /* ç§»é™¤æ»¾å‹•æ¢ */
            display: flex;
            flex-direction: column;
        }

        .submit-form h2 {
            color: #8b0000;
            margin-bottom: 5px;
            font-size: 1.6rem;
            flex-shrink: 0;
        }

        .score-display {
            font-size: 1.8rem;
            color: #8b0000;
            font-weight: bold;
            margin: 5px 0;
            text-align: center;
            flex-shrink: 0;
        }

        /* æ’è¡Œæ¦œå‰ä¸‰åå€åŸŸ - ç¸®å°ç‰ˆ */
        .top-three {
            background-color: #f9f9f9;
            padding: 8px 10px;
            border-radius: 8px;
            margin: 5px 0;
            text-align: center;
            flex-shrink: 0;
        }

        .top-three h3 {
            color: #8b0000;
            margin-bottom: 6px;
            font-size: 1.2rem;
        }

        .top-three-list {
            display: flex;
            justify-content: center;
            gap: 8px;
            margin-top: 5px;
        }

        .top-three-item {
            flex: 1;
            background: white;
            border-radius: 8px;
            padding: 8px 5px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.1);
            border: 2px solid transparent;
            min-width: 0;
        }

        .top-three-item.rank-1 {
            border-color: #ffd700;
            order: 2;
            transform: scale(1.03);
        }

        .top-three-item.rank-2 {
            border-color: #c0c0c0;
            order: 1;
        }

        .top-three-item.rank-3 {
            border-color: #cd7f32;
            order: 3;
        }

        .rank-icon {
            font-size: 1.5rem;
            margin-bottom: 3px;
        }

        .top-three-item .rank {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 2px;
        }

        .top-three-item .class-info {
            font-size: 0.9rem;
            font-weight: bold;
            color: #8b0000;
            margin-bottom: 2px;
        }

        .top-three-item .score {
            font-size: 1rem;
            font-weight: bold;
            color: #333;
        }

        .no-data {
            color: #666;
            font-style: italic;
            padding: 10px;
            font-size: 0.9rem;
        }

        /* è¡¨å–®å€å¡Š - å£“ç¸®é–“è· */
        .submit-form p {
            font-size: 0.9rem;
            margin: 5px 0 3px;
            flex-shrink: 0;
        }

        .form-row {
            display: flex;
            gap: 10px;
            margin-bottom: 8px;
            flex-shrink: 0;
        }

        .form-group {
            margin-bottom: 0;
            text-align: left;
            flex: 1;
        }

        .form-group label {
            display: block;
            margin-bottom: 2px;
            font-weight: bold;
            color: #333;
            font-size: 0.8rem;
        }

        select, input {
            width: 100%;
            padding: 6px 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .submit-form .button-container {
            margin-top: 5px;
            gap: 12px;
            flex-shrink: 0;
        }

        .submit-form .btn {
            padding: 8px 12px;
            font-size: 0.95rem;
        }

        /* ---------- æ’è¡Œæ¦œé é¢ï¼ˆå«æ¸…é™¤æŒ‰éˆ•ï¼‰ ---------- */
        .leaderboard {
            display: none;
            background-color: white;
            padding: 15px;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
            width: 100%;
            height: 100%;
            overflow-y: auto;
            flex-direction: column;
        }

        .leaderboard h2 {
            color: #8b0000;
            margin-bottom: 15px;
            text-align: center;
            font-size: 1.8rem;
            flex-shrink: 0;
        }

        .leaderboard-table {
            width: 100%;
            border-collapse: collapse;
            font-size: 0.9rem;
        }

        .leaderboard-table th, .leaderboard-table td {
            padding: 10px;
            text-align: center;
            border-bottom: 1px solid #eee;
        }

        .leaderboard-table th {
            background-color: #8b0000;
            color: white;
        }

        .leaderboard-table tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        .leaderboard-table tr:hover {
            background-color: #fff8e1;
        }

        .rank-1 { color: #ffd700; font-weight: bold; }
        .rank-2 { color: #c0c0c0; font-weight: bold; }
        .rank-3 { color: #cd7f32; font-weight: bold; }

        .leaderboard .button-container {
            margin-top: 15px;
            flex-shrink: 0;
        }

        /* æ¸…é™¤æ’è¡Œæ¦œæŒ‰éˆ•ï¼ˆç´…è‰²è­¦ç¤ºï¼‰ */
        .btn-clear {
            background-color: #cc0000;
            color: white;
            border: 2px solid #ffd700;
        }
        .btn-clear:hover {
            background-color: #ff4444;
        }

        /* æ¨ªå±ä¸“ç”¨æ ·å¼ */
        @media screen and (orientation: portrait) {
            #orientation-message {
                display: flex;
            }
            .container {
                display: none;
            }
        }

        @media screen and (orientation: landscape) and (max-height: 600px) {
            h1 { font-size: 2.2rem; }
            .subtitle { font-size: 0.8rem; padding: 5px 10px; }
            .language-selection { width: 60vw; height: 60vh; }
            .language-selection h2 { font-size: 1.2rem; }
            .language-btn { font-size: 1.2rem; }
            .language-btn i { font-size: 2rem; }
            .btn-view-leaderboard { font-size: 1rem; padding: 8px 16px; }
            .riddle-text { font-size: 1.5rem; }
            .option-btn { font-size: 1.1rem; padding: 10px 5px; }
            .stat-item .value { font-size: 1.1rem; }
            .top-three-list { flex-direction: column; align-items: center; }
            .top-three-item { width: 80%; }
        }

        @media screen and (min-width: 1200px) and (min-height: 700px) {
            .container { max-width: 1200px; max-height: 800px; padding: 20px; }
            h1 { font-size: 3.5rem; }
            .subtitle { font-size: 1.2rem; }
            .game-container { padding: 20px; }
            .riddle-text { font-size: 2.5rem; }
        }
    </style>
</head>
<body>
    <!-- å±å¹•æ–¹å‘æç¤º -->
    <div id="orientation-message">
        <i class="fas fa-sync-alt fa-spin"></i>
        <h2>è«‹æ—‹è½‰è¨­å‚™</h2>
        <p>å…ƒå®µç¯€çŒœç‡ˆè¬éŠæˆ²éœ€è¦åœ¨æ©«å±æ¨¡å¼ä¸‹éŠç©<br>è«‹å°‡è¨­å‚™æ—‹è½‰è‡³æ©«å‘æ¨¡å¼</p>
    </div>

    <div class="container">
        <header>
            <h1><i class="fas fa-lantern"></i> å…ƒå®µç¯€çŒœç‡ˆè¬</h1>
            <div class="subtitle">Lantern Festival Riddle Game</div>
        </header>

        <!-- æ¸¸æˆä¸»å®¹å™¨ -->
        <main class="game-container" id="game-container">
            <!-- è¯­è¨€é€‰æ‹©ç•Œé¢ + æŸ¥çœ‹æ’è¡Œæ¦œæŒ‰éˆ• -->
            <div class="language-selection" id="language-selection">
                <h2>è«‹é¸æ“‡éŠæˆ²èªè¨€ / Please Select Game Language</h2>
                <div class="language-options">
                    <div class="language-btn chinese" onclick="selectLanguage('chinese')">
                        <i class="fas fa-dragon"></i>
                        <span>ä¸­æ–‡ç‡ˆè¬</span>
                    </div>
                    <div class="language-btn english" onclick="selectLanguage('english')">
                        <i class="fas fa-globe"></i>
                        <span>English Riddles</span>
                    </div>
                </div>
                <!-- æ–°å¢æŸ¥çœ‹æ’è¡Œæ¦œæŒ‰éˆ• -->
                <button class="btn-view-leaderboard" onclick="toggleLeaderboard()">
                    <i class="fas fa-crown"></i> æŸ¥çœ‹æ’è¡Œæ¦œ
                </button>
            </div>

            <!-- æ¸¸æˆè¿›è¡Œç•Œé¢ -->
            <div id="game-screen">
                <div class="game-header">
                    <div class="stats">
                        <div class="stat-item">
                            <div>ç”¨æ™‚</div>
                            <div class="value" id="time-used">0</div>
                            <div>ç§’</div>
                        </div>
                        <div class="stat-item">
                            <div>åˆ†æ•¸å€ç‡</div>
                            <div class="value" id="score-multiplier">30.0</div>
                        </div>
                        <div class="stat-item">
                            <div>é¡Œç›®é€²åº¦</div>
                            <div class="value" id="progress-text">1/3</div>
                        </div>
                    </div>
                    <div class="restart-btn">
                        <button class="btn btn-secondary" onclick="restartGame()">
                            <i class="fas fa-redo"></i> é‡ä¾†
                        </button>
                    </div>
                </div>

                <!-- è¬é¡Œå€åŸŸ -->
                <div class="riddle-container">
                    <div class="riddle-text" id="riddle-text">é€™è£¡é¡¯ç¤ºç‡ˆè¬å…§å®¹</div>
                </div>

                <div class="options-container" id="options-container">
                    <!-- é€‰é¡¹å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </div>
            </div>

            <!-- æäº¤è¡¨å•ï¼ˆæŒ‘æˆ°å®Œæˆé é¢ï¼Œç„¡æ»¾å‹•æ¢ï¼Œç·Šæ¹Šæ’ç‰ˆï¼‰ -->
            <div class="submit-form" id="submit-form">
                <h2><i class="fas fa-trophy"></i> æŒ‘æˆ°å®Œæˆï¼</h2>
                <div class="score-display" id="final-score">45 åˆ†</div>
                
                <!-- æ’è¡Œæ¦œå‰ä¸‰ååŒºåŸŸï¼ˆå·²ç¸®å°ï¼‰ -->
                <div class="top-three" id="top-three">
                    <h3>ğŸ† æ’è¡Œæ¦œå‰ä¸‰å ğŸ†</h3>
                    <div class="loading" id="top-three-loading" style="display: none;">
                        <i class="fas fa-spinner fa-spin"></i>
                        <p>æ­£åœ¨åŠ è¼‰æ’è¡Œæ¦œæ•¸æ“š...</p>
                    </div>
                    <div class="top-three-list" id="top-three-list">
                        <!-- å‰ä¸‰åå°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                    </div>
                </div>
                
                <p>è«‹è¼¸å…¥æ‚¨çš„ç­åˆ¥å’Œå­¸è™Ÿä»¥ç™»ä¸Šæ’è¡Œæ¦œ</p>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="class-select">ç­åˆ¥ Class</label>
                        <select id="class-select">
                            <option value="">è«‹é¸æ“‡ç­åˆ¥</option>
                            <!-- ç”Ÿæˆ1Aåˆ°6Eé€‰é¡¹ -->
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="student-id">å­¸è™Ÿ Student ID (1-30)</label>
                        <input type="number" id="student-id" min="1" max="30" placeholder="è¼¸å…¥å­¸è™Ÿ">
                    </div>
                </div>
                
                <div class="button-container">
                    <button class="btn btn-primary" onclick="submitScore()">
                        <i class="fas fa-upload"></i> æäº¤åˆ†æ•¸
                    </button>
                    <button class="btn btn-secondary" onclick="playAgain()">
                        <i class="fas fa-play"></i> å†ç©ä¸€æ¬¡
                    </button>
                </div>
            </div>
        </main>

        <!-- æ’è¡Œæ¦œé é¢ï¼ˆå«æ¸…é™¤æŒ‰éˆ•ï¼‰ -->
        <div class="leaderboard" id="leaderboard">
            <h2><i class="fas fa-crown"></i> æ’è¡Œæ¦œ Leaderboard</h2>
            <div class="loading" id="leaderboard-loading">
                <i class="fas fa-spinner fa-spin"></i>
                <p>æ­£åœ¨åŠ è¼‰æ’è¡Œæ¦œæ•¸æ“š...</p>
            </div>
            <table class="leaderboard-table" id="leaderboard-table">
                <thead>
                    <tr>
                        <th>æ’å</th>
                        <th>ç­åˆ¥</th>
                        <th>å­¸è™Ÿ</th>
                        <th>åˆ†æ•¸</th>
                        <th>ç”¨æ™‚</th>
                        <th>å€ç‡</th>
                    </tr>
                </thead>
                <tbody id="leaderboard-body">
                    <!-- æ’è¡Œæ¦œæ•°æ®å°†é€šè¿‡JavaScriptåŠ¨æ€ç”Ÿæˆ -->
                </tbody>
            </table>
            <div class="button-container" style="margin-top: 15px;">
                <button class="btn btn-primary" onclick="showGameSelection()">
                    <i class="fas fa-home"></i> è¿”å›ä¸»é¸å–®
                </button>
                <button class="btn btn-secondary" onclick="toggleLeaderboard()">
                    <i class="fas fa-times"></i> é—œé–‰æ’è¡Œæ¦œ
                </button>
                <!-- æ–°å¢æ¸…é™¤æ’è¡Œæ¦œæŒ‰éˆ• -->
                <button class="btn btn-clear" onclick="promptClearLeaderboard()">
                    <i class="fas fa-trash-alt"></i> æ¸…é™¤æ’è¡Œæ¦œ
                </button>
            </div>
        </div>

        <!-- èƒœåˆ©è§†é¢‘ -->
        <video id="victory-video" preload="auto" loop>
            <source src="images/victory.mp4" type="video/mp4">
            æ‚¨çš„ç€è¦½å™¨ä¸æ”¯æ´è¦–é »æ’­æ”¾ã€‚
        </video>

        <!-- é è…³å·²å®Œå…¨ç§»é™¤ (å…ƒå®µç¯€çŒœç‡ˆè¬ Â© 2025 å­—æ¨£å·²åˆªé™¤) -->
    </div>

    <!-- Firebase SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, query, orderByChild, limitToLast, remove } from "https://www.gstatic.com/firebasejs/12.9.0/firebase-database.js";

        const firebaseConfig = {
            apiKey: "AIzaSyCkopSXKNpvKAyhlxaAUot2xQRlZTsnBCQ",
            authDomain: "hyp-lanterngame.firebaseapp.com",
            databaseURL: "https://hyp-lanterngame-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "hyp-lanterngame",
            storageBucket: "hyp-lanterngame.firebasestorage.app",
            messagingSenderId: "1018393426134",
            appId: "1:1018393426134:web:3cde75105b7809f949b177"
        };

        const app = initializeApp(firebaseConfig);
        const database = getDatabase(app);
        
        window.firebaseDatabase = database;
        window.firebaseRef = ref;
        window.firebasePush = push;
        window.firebaseSet = set;
        window.firebaseOnValue = onValue;
        window.firebaseQuery = query;
        window.firebaseOrderByChild = orderByChild;
        window.firebaseLimitToLast = limitToLast;
        window.firebaseRemove = remove;   // ç”¨æ–¼æ¸…é™¤æ’è¡Œæ¦œ
        
        console.log("Firebase åˆå§‹åŒ–å®Œæˆ");
    </script>
    
    <script>
        // æ¸¸æˆå…¨å±€å˜é‡
        let gameState = {
            language: 'chinese',
            riddles: [],          // å½“å‰è½®æŠ½ä¸­çš„3é“é¢˜
            allRiddles: [],       // ä»JSONåŠ è½½çš„å®Œæ•´é¢˜åº“
            currentRiddleIndex: 0,
            correctAnswers: 0,
            timeUsed: 0,
            startTime: 0,
            timer: null,
            answered: false,
            gameCompleted: false,
            gameScreenActive: false
        };

        // Firebaseæ•°æ®åº“å¼•ç”¨
        let leaderboardRef = null;

        // å±å¹•æ–¹å‘æ£€æµ‹
        function checkOrientation() {
            const orientationMessage = document.getElementById('orientation-message');
            const container = document.querySelector('.container');
            
            if (window.innerWidth > window.innerHeight) {
                orientationMessage.style.display = 'none';
                container.style.display = 'flex';
            } else {
                orientationMessage.style.display = 'flex';
                container.style.display = 'none';
            }
        }

        // åˆå§‹åŒ–æ¸¸æˆ
        document.addEventListener('DOMContentLoaded', function() {
            checkOrientation();
            window.addEventListener('resize', checkOrientation);
            window.addEventListener('orientationchange', checkOrientation);
            
            generateClassOptions();
            
            if (window.firebaseRef) {
                leaderboardRef = window.firebaseRef(window.firebaseDatabase, 'leaderboard');
                console.log("Firebase å¼•ç”¨å·²åˆå§‹åŒ–");
            } else {
                console.error("Firebase æœªæ­£ç¡®åˆå§‹åŒ–");
            }
            
            showLanguageSelection();
            
            const bgImage = new Image();
            bgImage.onload = function() { console.log('èƒŒæ™¯åœ–ç‰‡åŠ è¼‰æˆåŠŸ'); };
            bgImage.onerror = function() {
                console.log('èƒŒæ™¯åœ–ç‰‡åŠ è¼‰å¤±æ•—ï¼Œä½¿ç”¨é»˜èªèƒŒæ™¯');
                document.body.style.backgroundImage = 'none';
            };
            bgImage.src = 'images/background.png';
            
            window.addEventListener('resize', function() {
                if (gameState.gameScreenActive) {
                    adjustRiddleFontSize();
                }
            });
        });

        // ç”Ÿæˆç­åˆ«é€‰é¡¹ (1A-6E)
        function generateClassOptions() {
            const classSelect = document.getElementById('class-select');
            const grades = ['1', '2', '3', '4', '5', '6'];
            const classes = ['A', 'B', 'C', 'D', 'E'];
            classSelect.innerHTML = '<option value="">è«‹é¸æ“‡ç­åˆ¥</option>';
            grades.forEach(grade => {
                classes.forEach(cls => {
                    const option = document.createElement('option');
                    option.value = `${grade}${cls}`;
                    option.textContent = `${grade}${cls}`;
                    classSelect.appendChild(option);
                });
            });
        }

        // é€‰æ‹©è¯­è¨€
        function selectLanguage(lang) {
            gameState.language = lang;
            updateUITextForLanguage(lang);
            loadRiddlesFromFile(lang);
        }

        // æ ¹æ®è¯­è¨€æ›´æ–°UIæ–‡æœ¬
        function updateUITextForLanguage(lang) {
            const texts = {
                'chinese': { 'time-label': 'ç”¨æ™‚', 'multiplier-label': 'åˆ†æ•¸å€ç‡', 'progress-label': 'é¡Œç›®é€²åº¦' },
                'english': { 'time-label': 'Time Used', 'multiplier-label': 'Score Multiplier', 'progress-label': 'Progress' }
            }[lang];
            const statItems = document.querySelectorAll('.stat-item');
            statItems[0].querySelector('div:first-child').textContent = texts['time-label'];
            statItems[1].querySelector('div:first-child').textContent = texts['multiplier-label'];
            statItems[2].querySelector('div:first-child').textContent = texts['progress-label'];
        }

        // å¾JSONæ–‡ä»¶è¼‰å…¥ç‡ˆè¬åº«ï¼ˆä¸æª¢æŸ¥localStorageï¼‰
        function loadRiddlesFromFile(lang) {
            const filename = lang === 'chinese' ? 'docx/chi.json' : 'docx/eng.json';
            fetch(filename)
                .then(response => { if (!response.ok) throw new Error(`ç„¡æ³•åŠ è¼‰ ${filename}`); return response.json(); })
                .then(data => {
                    console.log(`å·²å¾æ–‡ä»¶åŠ è¼‰ ${data.length} å€‹${lang==='chinese'?'ä¸­æ–‡':'è‹±æ–‡'}ç‡ˆè¬`);
                    gameState.allRiddles = data;
                    pickRandomRiddles();
                    showGameScreen();
                })
                .catch(error => {
                    console.error(`åŠ è¼‰ç‡ˆè¬åº«å¤±æ•—: ${error.message}`);
                    alert(`æ‰¾ä¸åˆ°${lang==='chinese'?'ä¸­æ–‡':'è‹±æ–‡'}ç‡ˆè¬åº«ï¼Œè«‹ç¢ºèª docx/chi.json æˆ– docx/eng.json æª”æ¡ˆæ˜¯å¦å­˜åœ¨ã€‚`);
                });
        }

        // å¾å®Œæ•´é¡Œåº«ä¸­éš¨æ©ŸæŠ½å–3é“é¡Œ
        function pickRandomRiddles() {
            if (!gameState.allRiddles || gameState.allRiddles.length === 0) {
                gameState.riddles = [];
                return;
            }
            const shuffled = shuffleArray([...gameState.allRiddles]);
            gameState.riddles = shuffled.slice(0, 3);
            console.log('æœ¬è¼ªæŠ½é¡Œ:', gameState.riddles);
        }

        // æ˜¾ç¤ºè¯­è¨€é€‰æ‹©ç•Œé¢
        function showLanguageSelection() {
            document.getElementById('language-selection').style.display = 'flex';
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('submit-form').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'none';
            gameState.gameScreenActive = false;
        }

        // æ˜¾ç¤ºæ¸¸æˆç•Œé¢
        function showGameScreen() {
            if (!gameState.riddles || gameState.riddles.length === 0) {
                alert('ç›®å‰æ²’æœ‰å¯ç”¨çš„ç‡ˆè¬ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                return;
            }
            document.getElementById('language-selection').style.display = 'none';
            document.getElementById('game-screen').style.display = 'flex';
            document.getElementById('submit-form').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'none';
            gameState.gameScreenActive = true;
            resetGame();
            startGame();
        }

        // é‡ç½®æ¸¸æˆçŠ¶æ€
        function resetGame() {
            gameState.currentRiddleIndex = 0;
            gameState.correctAnswers = 0;
            gameState.timeUsed = 0;
            gameState.answered = false;
            gameState.gameCompleted = false;
            updateTime();
            updateMultiplier();
            updateProgress();
            if (gameState.timer) clearInterval(gameState.timer);
        }

        // å¼€å§‹æ¸¸æˆ
        function startGame() {
            gameState.startTime = Date.now();
            gameState.timer = setInterval(() => {
                gameState.timeUsed = Math.floor((Date.now() - gameState.startTime) / 1000);
                updateTime();
                updateMultiplier();
            }, 100);
            displayCurrentRiddle();
        }

        // æ˜¾ç¤ºå½“å‰ç¯è°œ
        function displayCurrentRiddle() {
            const riddle = gameState.riddles[gameState.currentRiddleIndex];
            const riddleText = document.getElementById('riddle-text');
            riddleText.textContent = riddle.question;
            
            const isEnglish = gameState.language === 'english';
            riddleText.style.whiteSpace = isEnglish ? 'pre' : 'normal';
            riddleText.style.wordBreak = isEnglish ? 'normal' : 'break-word';
            
            generateOptions(riddle);
            gameState.answered = false;
            adjustRiddleFontSize();
        }

        // è‡ªé©æ‡‰è¬é¢å­—é«”å¤§å°ï¼ˆè‹±æ–‡æœ€å°18pxï¼‰
        function adjustRiddleFontSize() {
            const container = document.querySelector('.riddle-container');
            const riddleText = document.getElementById('riddle-text');
            if (!container || !riddleText) return;
            const text = riddleText.textContent;
            if (!text) return;
            const isEnglish = gameState.language === 'english';
            const originalWhiteSpace = riddleText.style.whiteSpace;
            if (isEnglish) riddleText.style.whiteSpace = 'pre';
            
            const containerWidth = container.clientWidth;
            const containerHeight = container.clientHeight;
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            
            let low = isEnglish ? 18 : 10;   // è‹±æ–‡æœ€å°18px
            let high = 200;
            let fontSize = low;
            
            for (let i = 0; i < 10; i++) {
                const mid = Math.floor((low + high) / 2);
                context.font = `bold ${mid}px 'Noto Sans SC', sans-serif`;
                let maxWidth = 0;
                if (isEnglish) {
                    const lines = text.split('\n');
                    lines.forEach(line => { maxWidth = Math.max(maxWidth, context.measureText(line).width); });
                } else {
                    maxWidth = context.measureText(text).width;
                }
                riddleText.style.fontSize = mid + 'px';
                const scrollHeight = riddleText.scrollHeight;
                const widthOK = isEnglish ? true : (maxWidth < containerWidth * 0.95);
                const heightOK = scrollHeight < containerHeight * 0.9;
                if (widthOK && heightOK) {
                    fontSize = mid;
                    low = mid + 1;
                } else {
                    high = mid - 1;
                }
            }
            
            if (isEnglish && fontSize < 18) fontSize = 18;
            riddleText.style.fontSize = fontSize + 'px';
            
            let safeCount = 0;
            while (safeCount < 20) {
                if (riddleText.scrollHeight <= container.clientHeight) break;
                fontSize = Math.max(isEnglish ? 18 : 8, fontSize - 2);
                riddleText.style.fontSize = fontSize + 'px';
                safeCount++;
            }
            riddleText.style.whiteSpace = isEnglish ? 'pre' : 'normal';
        }

        // ç”Ÿæˆé€‰é¡¹
        function generateOptions(riddle) {
            const optionsContainer = document.getElementById('options-container');
            optionsContainer.innerHTML = '';
            let options = [riddle.answer, ...riddle.distractors];
            options = shuffleArray(options);
            options.forEach(option => {
                const button = document.createElement('button');
                button.className = 'option-btn';
                button.textContent = option;
                button.onclick = () => selectOption(option, button, riddle.answer);
                optionsContainer.appendChild(button);
            });
        }

        // é€‰æ‹©é€‰é¡¹
        function selectOption(selected, button, correctAnswer) {
            if (gameState.answered) return;
            if (selected === correctAnswer) {
                gameState.answered = true;
                gameState.correctAnswers++;
                button.classList.add('correct');
                document.querySelectorAll('.option-btn').forEach(btn => btn.classList.add('disabled'));
                setTimeout(() => nextRiddle(), 1000);
            } else {
                button.classList.add('wrong');
                button.classList.add('disabled');
            }
        }

        // ä¸‹ä¸€é¢˜
        function nextRiddle() {
            gameState.currentRiddleIndex++;
            if (gameState.currentRiddleIndex < gameState.riddles.length) {
                updateProgress();
                displayCurrentRiddle();
            } else {
                endGame();
            }
        }

        // ç»“æŸæ¸¸æˆ
        function endGame() {
            clearInterval(gameState.timer);
            gameState.gameCompleted = true;
            const finalScore = calculateFinalScore();
            showVictoryVideo();
            setTimeout(() => showFinalScore(finalScore), 3000);
        }

        // è®¡ç®—æœ€ç»ˆåˆ†æ•°
        function calculateFinalScore() {
            const multiplier = Math.max(0, 30 - (gameState.timeUsed * 0.5));
            const score = Math.round(gameState.correctAnswers * 15 * multiplier);
            return { score, multiplier, timeUsed: gameState.timeUsed, correctAnswers: gameState.correctAnswers };
        }

        // æ˜¾ç¤ºæœ€ç»ˆåˆ†æ•°
        function showFinalScore(finalScore) {
            const scoreText = gameState.language === 'chinese' ? `${finalScore.score} åˆ†` : `${finalScore.score} points`;
            document.getElementById('final-score').textContent = scoreText;
            displayTopThree();
            document.getElementById('game-screen').style.display = 'none';
            document.getElementById('submit-form').style.display = 'flex';  // æ”¹ç‚ºflexä»¥é©æ‡‰å‚ç›´æ’åˆ—
            gameState.gameScreenActive = false;
        }

        // æ˜¾ç¤ºèƒœåˆ©è§†é¢‘
        function showVictoryVideo() {
            const video = document.getElementById('victory-video');
            video.style.display = 'block';
            video.play().catch(e => console.log('è¦–é »æ’­æ”¾å¤±æ•—:', e));
            setTimeout(() => { video.style.display = 'none'; video.pause(); video.currentTime = 0; }, 3000);
        }

        // æ˜¾ç¤ºæ’è¡Œæ¦œå‰ä¸‰å
        function displayTopThree() {
            const topThreeList = document.getElementById('top-three-list');
            const topThreeLoading = document.getElementById('top-three-loading');
            topThreeList.innerHTML = '';
            topThreeLoading.style.display = 'block';
            if (!leaderboardRef) {
                topThreeLoading.style.display = 'none';
                topThreeList.innerHTML = '<div class="no-data">Firebase æœªæ­£ç¢ºåˆå§‹åŒ–</div>';
                return;
            }
            const topScoresQuery = window.firebaseQuery(leaderboardRef, window.firebaseOrderByChild('score'), window.firebaseLimitToLast(3));
            window.firebaseOnValue(topScoresQuery, (snapshot) => {
                topThreeLoading.style.display = 'none';
                const data = snapshot.val();
                if (!data) { topThreeList.innerHTML = '<div class="no-data">æš«ç„¡æ’è¡Œæ¦œæ•¸æ“š</div>'; return; }
                const leaderboardArray = [];
                for (const key in data) leaderboardArray.push({ id: key, ...data[key] });
                leaderboardArray.sort((a, b) => b.score - a.score);
                const topThree = leaderboardArray.slice(0, 3);
                if (topThree.length === 0) { topThreeList.innerHTML = '<div class="no-data">æš«ç„¡æ’è¡Œæ¦œæ•¸æ“š</div>'; return; }
                const ranks = [
                    { class: 'rank-1', icon: 'ğŸ¥‡', label: 'ç¬¬ä¸€å' },
                    { class: 'rank-2', icon: 'ğŸ¥ˆ', label: 'ç¬¬äºŒå' },
                    { class: 'rank-3', icon: 'ğŸ¥‰', label: 'ç¬¬ä¸‰å' }
                ];
                topThree.forEach((entry, index) => {
                    const rank = ranks[index];
                    const item = document.createElement('div');
                    item.className = `top-three-item ${rank.class}`;
                    item.innerHTML = `<div class="rank-icon">${rank.icon}</div><div class="rank">${rank.label}</div><div class="class-info">${entry.class} - ${entry.studentId}</div><div class="score">${entry.score} åˆ†</div>`;
                    topThreeList.appendChild(item);
                });
                for (let i = topThree.length; i < 3; i++) {
                    const rank = ranks[i];
                    const item = document.createElement('div');
                    item.className = `top-three-item ${rank.class}`;
                    item.style.opacity = '0.5';
                    item.innerHTML = `<div class="rank-icon">${rank.icon}</div><div class="rank">${rank.label}</div><div class="class-info">---</div><div class="score">--- åˆ†</div>`;
                    topThreeList.appendChild(item);
                }
            }, (error) => {
                topThreeLoading.style.display = 'none';
                topThreeList.innerHTML = `<div class="no-data">åŠ è¼‰å¤±æ•—: ${error.message}</div>`;
                console.error("Firebase è®€å–éŒ¯èª¤:", error);
            });
        }

        // æäº¤åˆ†æ•°
        function submitScore() {
            const classSelect = document.getElementById('class-select');
            const studentId = document.getElementById('student-id').value;
            if (!classSelect.value || !studentId) {
                alert(gameState.language === 'chinese' ? 'è«‹é¸æ“‡ç­åˆ¥ä¸¦è¼¸å…¥å­¸è™Ÿ' : 'Please select class and enter student ID');
                return;
            }
            const finalScore = calculateFinalScore();
            addToLeaderboard(classSelect.value, studentId, finalScore.score, finalScore.timeUsed, finalScore.multiplier);
            document.getElementById('submit-form').style.display = 'none';
            document.getElementById('leaderboard').style.display = 'flex';
            classSelect.value = '';
            document.getElementById('student-id').value = '';
        }

        // æ·»åŠ åˆ°æ’è¡Œæ¦œ
        function addToLeaderboard(className, studentId, score, time, multiplier) {
            if (!leaderboardRef) { alert('Firebase æœªæ­£ç¢ºåˆå§‹åŒ–'); return; }
            const newScoreRef = window.firebasePush(leaderboardRef);
            window.firebaseSet(newScoreRef, {
                class: className, studentId, score, time, multiplier,
                timestamp: Date.now(), language: gameState.language
            }).then(() => { console.log("åˆ†æ•¸å·²æäº¤"); loadLeaderboard(); })
              .catch((error) => { console.error("æäº¤å¤±æ•—:", error); alert('æäº¤åˆ†æ•¸å¤±æ•—'); });
        }

        // åŠ è½½æ’è¡Œæ¦œæ•°æ®
        function loadLeaderboard() {
            const leaderboardBody = document.getElementById('leaderboard-body');
            const leaderboardLoading = document.getElementById('leaderboard-loading');
            const leaderboardTable = document.getElementById('leaderboard-table');
            leaderboardBody.innerHTML = '';
            leaderboardLoading.style.display = 'block';
            leaderboardTable.style.display = 'none';
            if (!leaderboardRef) {
                leaderboardLoading.style.display = 'none';
                leaderboardBody.innerHTML = '<tr><td colspan="6" style="padding:30px;text-align:center;color:#666;">Firebase æœªæ­£ç¢ºåˆå§‹åŒ–</td></tr>';
                leaderboardTable.style.display = 'table';
                return;
            }
            const leaderboardQuery = window.firebaseQuery(leaderboardRef, window.firebaseOrderByChild('score'));
            window.firebaseOnValue(leaderboardQuery, (snapshot) => {
                leaderboardLoading.style.display = 'none';
                leaderboardTable.style.display = 'table';
                const data = snapshot.val();
                if (!data) {
                    leaderboardBody.innerHTML = '<tr><td colspan="6" style="padding:30px;text-align:center;color:#666;">æš«ç„¡æ’è¡Œæ¦œæ•¸æ“š</td></tr>';
                    return;
                }
                const leaderboardArray = [];
                for (const key in data) leaderboardArray.push({ id: key, ...data[key] });
                leaderboardArray.sort((a, b) => b.score - a.score);
                const topScores = leaderboardArray.slice(0, 20);
                leaderboardBody.innerHTML = '';
                topScores.forEach((entry, index) => {
                    const row = document.createElement('tr');
                    if (index === 0) row.classList.add('rank-1');
                    else if (index === 1) row.classList.add('rank-2');
                    else if (index === 2) row.classList.add('rank-3');
                    row.innerHTML = `<td>${index + 1}</td><td>${entry.class}</td><td>${entry.studentId}</td><td>${entry.score}</td><td>${entry.time}ç§’</td><td>${entry.multiplier.toFixed(1)}</td>`;
                    leaderboardBody.appendChild(row);
                });
            }, (error) => {
                leaderboardLoading.style.display = 'none';
                leaderboardTable.style.display = 'table';
                leaderboardBody.innerHTML = `<tr><td colspan="6" style="padding:30px;text-align:center;color:#ff4444;">åŠ è¼‰å¤±æ•—: ${error.message}</td></tr>`;
                console.error("Firebase è®€å–éŒ¯èª¤:", error);
            });
        }

        // ---------- æ¸…é™¤æ’è¡Œæ¦œåŠŸèƒ½ï¼ˆå¯†ç¢¼ hypldhï¼‰----------
        function promptClearLeaderboard() {
            const pwd = prompt('è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ä»¥æ¸…é™¤æ’è¡Œæ¦œï¼š');
            if (pwd === 'hypldh') {
                if (confirm('ç¢ºå®šè¦æ¸…é™¤æ‰€æœ‰æ’è¡Œæ¦œè³‡æ–™å—ï¼Ÿæ­¤æ“ä½œç„¡æ³•å¾©åŸã€‚')) {
                    clearLeaderboard();
                }
            } else {
                alert('å¯†ç¢¼éŒ¯èª¤ï¼Œç„¡æ¬Šé™æ¸…é™¤æ’è¡Œæ¦œã€‚');
            }
        }

        function clearLeaderboard() {
            if (!leaderboardRef) {
                alert('Firebase æœªæ­£ç¢ºåˆå§‹åŒ–');
                return;
            }
            window.firebaseSet(leaderboardRef, null)
                .then(() => {
                    alert('æ’è¡Œæ¦œå·²æˆåŠŸæ¸…é™¤ï¼');
                    loadLeaderboard();  // é‡æ–°è¼‰å…¥ï¼ˆé¡¯ç¤ºç©ºç™½ï¼‰
                })
                .catch((error) => {
                    console.error('æ¸…é™¤æ’è¡Œæ¦œå¤±æ•—:', error);
                    alert('æ¸…é™¤å¤±æ•—ï¼Œè«‹ç¨å¾Œå†è©¦ã€‚');
                });
        }

        // åˆ‡æ¢æ’è¡Œæ¦œæ˜¾ç¤º
        function toggleLeaderboard() {
            const leaderboard = document.getElementById('leaderboard');
            if (leaderboard.style.display === 'flex' || leaderboard.style.display === 'block') {
                leaderboard.style.display = 'none';
                showLanguageSelection();
            } else {
                leaderboard.style.display = 'flex';
                document.getElementById('language-selection').style.display = 'none';
                document.getElementById('game-screen').style.display = 'none';
                document.getElementById('submit-form').style.display = 'none';
                loadLeaderboard();
            }
        }

        // é‡æ–°å¼€å§‹æ¸¸æˆï¼ˆé‡æ–°è¼‰å…¥é¡Œåº«ä¸¦æŠ½é¡Œï¼‰
        function restartGame() {
            if (confirm(gameState.language === 'chinese' 
                ? 'ç¢ºå®šè¦é‡æ–°é–‹å§‹éŠæˆ²å—ï¼Ÿç•¶å‰é€²åº¦å°‡æœƒä¸Ÿå¤±ï¼Œä¸¦é‡æ–°æŠ½å–é¡Œç›®ã€‚' 
                : 'Are you sure you want to restart? Your current progress will be lost and new riddles will be selected.')) {
                loadRiddlesFromFile(gameState.language);
            }
        }

        // å†ç©ä¸€æ¬¡ï¼ˆè¿”å›ä¸»é¸å–®ï¼‰
        function playAgain() {
            document.getElementById('submit-form').style.display = 'none';
            showLanguageSelection();
        }

        // è¿”å›æ¸¸æˆé€‰æ‹©ï¼ˆå¾æ’è¡Œæ¦œè¿”å›ï¼‰
        function showGameSelection() {
            document.getElementById('leaderboard').style.display = 'none';
            showLanguageSelection();
        }

        // æ›´æ–°ç”¨æ—¶æ˜¾ç¤º
        function updateTime() { document.getElementById('time-used').textContent = gameState.timeUsed; }
        // æ›´æ–°å€ç‡æ˜¾ç¤º
        function updateMultiplier() {
            const multiplier = Math.max(0, 30 - (gameState.timeUsed * 0.5));
            document.getElementById('score-multiplier').textContent = multiplier.toFixed(1);
        }
        // æ›´æ–°è¿›åº¦æ˜¾ç¤º
        function updateProgress() {
            document.getElementById('progress-text').textContent = `${gameState.currentRiddleIndex + 1}/${gameState.riddles.length}`;
        }
        // å·¥å…·å‡½æ•°ï¼šæ‰“ä¹±æ•°ç»„é¡ºåº
        function shuffleArray(array) {
            const newArray = [...array];
            for (let i = newArray.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [newArray[i], newArray[j]] = [newArray[j], newArray[i]];
            }
            return newArray;
        }
    </script>
</body>
</html>
